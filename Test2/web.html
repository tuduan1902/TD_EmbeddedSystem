<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CONTROL MPU6050</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<style>
        body{ font: 15px sans-serif; }
        .wrapper2{float: left; bottom:90px; right:550px;text-align: right;}
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
    <style>
        body{ font: 15px sans-serif; }
        .wrapper1{ float: left; width: 60%; padding: 20px; margin: 20px; height: 600px; }
        .xuatgtr{ width: 200%; padding: 20px; margin: 20px; height: 60%; }
        .box1{ margin: auto; width: 90%;}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.2.0/chart.min.js"> </script>
</head>
<body>     
    <div class="wrapper1 border border-2 rounded border-primary">
        <center>
            <h5 style="color: #00695c;"><b> CHART OF MPU6050 </b></h5>
        </center>
        <canvas id="myChart"></canvas>
        <br>
    </div>
    <script >
        // Tao bien trong chua noi dung cua do thi
        var label = [];
        var roll = [];
        var pitch = [];
        var yaw = [];
        
        // Data trong do thi
        const chartdata = {
            labels: label,
            datasets: [{
                label: 'roll',
                backgroundColor: 'rgb(178, 0, 31)',
                borderColor: 'rgb(178, 0, 31)',
                data: roll
            },
            {
                label: 'pitch',
                backgroundColor: 'rgb(0, 98, 65)',
                borderColor: 'rgb(0, 98, 65)',
                data: pitch
            },
            {
                label: 'yaw',
                backgroundColor: 'rgb(0, 109, 139)',
                borderColor: 'rgb(0, 109, 139)',
                data: yaw
            }
        
            ]
        };
        ///
        const config = {
            type: 'line',
            data: chartdata,
            options: {
                animation:false,
                scales: {xAxes: { title: { display: true, text: 'Number of sampling times',font: {size: 15}}},
                         yAxes: { title: { display: true, text: 'Values of Accelerometer Measurements',font: {size: 15}}}}
            }
        };

        /// Ve do thi
        var myChart = new Chart(
            document.getElementById('myChart'),
            config
        );

        // load data tu database
        $(document).ready(function(){
            updateChart(); /// Ve khung do thi
            updateTable(); /// Cap nhat bang
        });
        setInterval(updateChart,1000);
        function updateChart(){
            // gui request xuong database de lay data
            $.post('readData.php',function(data){

                // Reset bien moi lan dc goi - tranh truong hop data bi don them
                var label = [];
                var roll = [];
                var pitch = [];
                var yaw = [];
                var r = [];
                var p =[];
                var y = [];

                for(var i in data){
                    label.push(data[i].stt); //them phan tu vao trong chuoi
                    roll.push(data[i].roll);
                    pitch.push(data[i].pitch);
                    yaw.push(data[i].yaw);
                    r.push(data[i].roll);
                    p.push(data[i].pitch);
                    y.push(data[i].yaw);
                }
                // console.log(data1);
                myChart.data.labels = label;
                
                // Cap nhat data lien tuc -> dua len doc gia tri tren web

                myChart.data.datasets[0].data = roll;
                if(myChart.data.datasets[0].data = roll) 
                {
                    document.getElementById("r").innerHTML = r[i];
                }

                myChart.data.datasets[1].data = pitch;
                if(myChart.data.datasets[1].data = pitch)
                {
                    document.getElementById("p").innerHTML = p[i];
                }

                myChart.data.datasets[1].data = yaw;
                if(myChart.data.datasets[1].data = yaw)
                {
                    document.getElementById("y").innerHTML = y[i];
                }
                myChart.update();
            })
        } 

    </script>  
     <div class="wrapper2">
        <br><br><br>
        <center class="xuatgtr">
            <h5 style="color: #00695c;"><b>VALUES OF ROLL, PITCH, YAW</b></h5>
        
            <table class="table table-hover table-striped">
                <tr>
                    <th scope="col">Roll : </th> 
                    <td id="r">  </td>   
                </tr>
                <tr>
                    <th scope="col">Pitch : </th> 
                    <td id="p">  </td>   
                </tr>
                <tr>
                    <th scope="col">Yaw : </th> 
                    <td id="y">  </td>   
                </tr>
            </table>
        </center>
    </div>
</body>
</html>
